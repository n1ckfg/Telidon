<!DOCTYPE html>
<html>

	<head>
		<title>TelidonP5 Project</title>
		<link type="text/css" rel="stylesheet" href="./css/main.css"/>
		<script type="text/javascript" src="./js/libraries/p5js/p5.min.js"></script>
		<script type="text/javascript" src="./js/libraries/p5js/p5.dom.min.js"></script>
		<script type="text/javascript" src="./js/libraries/gifjs/gif.js"></script>
		<script type="text/javascript" src="./js/telidon/naplps.js"></script>
		<script type="text/javascript" src="./js/telidon/TelidonP5.js"></script>
		<script type="text/javascript">
			"use strict";

			let recording = true;
			let c;
			let gif;
			let posCounterX = 0;
			let posCounterY = 0;

			let telidon = [];
			let maxLength = 3;

			let dropZone;
			let sW = 640;
			let sH = 480;

			let defaultFont;

			let preview, explanation, explanationbg;
			let shark, skull, santa, beer, haunt, email, mouse;

			let isMobile = false;


			function preload() {
			    isMobile = detectMobile();

			    if (isMobile) loadNewTelidon("./images/shark.nap");
			}

			function setup() {
				c = createCanvas(sW, sH);
				c.position(0, 29);

			    if (!isMobile) setupGif();

				dropZone = document.getElementsByTagName("body")[0];
			    dropZone.addEventListener('dragover', onDragOver);
			    dropZone.addEventListener('drop', onDrop);
			    
			    defaultFont = loadFont("./archives/fonts/Telidon-Bold/Telidon-Bold.ttf", function(font) {
			        textFont(font);
			        textSize(36);
			        textAlign(LEFT);        
			    });

			    preview = document.getElementById("preview");
			    setPreview("shark");
			    
			    explanation = document.getElementById("explanation");
			    explanationbg = document.getElementById("explanation-bg");
			    explanation.addEventListener("click", function() {
			        explanation.style = "opacity: 0";
			        explanationbg.style = "opacity: 0";
			    });

			    shark = document.getElementById("shark").addEventListener("click", function() {
			        loadNewTelidon("./images/shark.nap");
			        setPreview("shark");
			    });

			    skull = document.getElementById("skull").addEventListener("click", function() {
			        loadNewTelidon("./images/wast.nap");
			        setPreview("skull");
			    });

			    santa = document.getElementById("santa").addEventListener("click", function() {
			        loadNewTelidon("./images/santa.nap");
			        setPreview("santa");
			    });

			    beer = document.getElementById("beer").addEventListener("click", function() {
			        loadNewTelidon("./images/beer.nap");
			        setPreview("beer");
			    });

			    haunt = document.getElementById("haunt").addEventListener("click", function() {
			        loadNewTelidon("./images/haunt.nap");
			        setPreview("haunt");
			    });

			    email = document.getElementById("email").addEventListener("click", function() {
			        loadNewTelidon("./images/email2.nap");
			        setPreview("email");
			    });

			    mouse = document.getElementById("mouse").addEventListener("click", function() {
			        loadNewTelidon("./images/tb1.nap");
			        setPreview("mouse");
			    });
			}

			function draw() {    
				background(32);
			    if (telidon.length < 1) {
			        fill(255);
			        textAlign(CENTER);
			        text("\\\\ DRAG ' n ' DROP //", width/2, height/2);
			        textAlign(LEFT);
			        return;
			    }

			    translate(0,sH-sW);
				
			    for (let i=0; i<telidon.length; i++) {
					telidon[i].draw();
				}

			    if (!isMobile && recording && frameCount % 2 == 0) {
			        gif.addFrame(c.elt, {delay: 1, copy: true});
			    }

			    if (!isMobile && recording && telidon[telidon.length-1].finished) {
			        recording = false;
			        gif.render();
			    }
			}

			// Show the copy icon when dragging over.  Seems to only work for chrome.
			function onDragOver(e) {
			    e.stopPropagation();
			    e.preventDefault();
			    e.dataTransfer.dropEffect = 'copy';    
			}

			function onDrop(e) {
			    e.stopPropagation();
			    e.preventDefault();
			    let files = e.dataTransfer.files; // Array of all files
			    for (let i=0, file; file=files[i]; i++) {
			        let reader = new FileReader();
			        reader.onload = function(e2) {
			            if (telidon.length >= maxLength) telidon.splice(0,1);
			            telidon.push(new TelidonDraw([e2.target.result], sW, sW));
			            recording = true;
			            preview.style.backgroundImage = null;
			        }
			        reader.readAsText(file, 'UTF-8');
			    }      
			}


			function loadNewTelidon(fileName) { 
			    loadStrings(fileName, function(response) {
			        telidon = [];
			        let reader = new FileReader();
			        reader.onload = function(e2) {
			            telidon.push(new TelidonDraw([e2.target.result], sW, sW));
			            recording = true;
			        }
			        reader.readAsText(new Blob(response), 'UTF-8');
			    });
			}

			function setPreview(name) {
			    preview.style.backgroundImage = "url(./tools/rosetta_stone/cover/png/" + name + ".png)";
			}

			function setupGif() {
			    gif = new GIF({
			        workers: 4,
			        workerScript: './js/libraries/gifjs/gif.worker.js', // https://github.com/jnordberg/gif.js/issues/59
			        quality: 40
			    });

			    gif.on('finished', function(blob) {
			        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/srcObject
			        let img = document.createElement('img');
			        img.src = URL.createObjectURL(blob);
			        img.style = "width: " + sW/2 + "px; height: " + sH/2 + "px; position: absolute; left: " + posCounterX + "px; top: " + (posCounterY + sH + 29) + "px;";
			        posCounterX += sW/2;
			        if (posCounterX > 1.5 * sW) {
			            posCounterX = 0;
			            posCounterY += sH/2;
			        }
			        document.body.appendChild(img);

			        setupGif();
			    });
			}

			function detectMobile() {
			    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)) {
			        return true;
			    } else {
			        return false;
			    }
			}			
		</script>
	</head>

	<body>
		<div id="container">
			<div class="sketch">
				&nbsp;&nbsp;<a href="https://github.com/n1ckfg/Telidon"><i>source</i></a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="javascript:void(0)" id="shark">shark</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="javascript:void(0)" id="skull">skull</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="javascript:void(0)" id="santa">santa</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="javascript:void(0)" id="beer">beer</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="javascript:void(0)" id="haunt">haunt</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="javascript:void(0)" id="email">email</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="javascript:void(0)" id="mouse">mouse</a><br>
			</div>

			<div class="preview-base" id="preview"></div>

			<div class="preview-base" id="explanation-bg"></div>
			<div class="explanation-base" id="explanation">
				<p>
					<b><a href="https://github.com/n1ckfg/Telidon/blob/master/js/telidon/TelidonP5.js">TelidonP5.js</a></b> allows NAPLPS vector graphics files to be displayed in a browser using <a href="https://p5js.org/">p5.js</a>. Its companion decoder library <b><a href="https://github.com/n1ckfg/Telidon/blob/master/js/telidon/naplps-decoder.js">naplps-decoder.js</a></b> can also be used independently.
				</p>
				<p>
					August 15th, 2018 marked the 40th anniversary of the <a href="https://en.wikipedia.org/wiki/Telidon">Telidon</a> graphics format, created in 1978. The Telidon hardware was discontinued in 1985, but a variant of the format, <a href="https://en.wikipedia.org/wiki/NAPLPS">NAPLPS</a>, thrived and remained in wide use throughout the <a href="https://en.wikipedia.org/wiki/Bulletin_board_system">BBS</a> era, until the early 1990s. Thanks to its exceptionally small file size and limited animation features, it can be seen as a technological ancestor of the <a href="https://en.wikipedia.org/wiki/GIF#Animated_GIF">animated GIF</a> and the <a href="https://en.wikipedia.org/wiki/SWF">Flash SWF</a>&mdash;a medium that allowed new types of work to be both produced and consumed on the same machine.
				</p>
				<p>
					From 1982&ndash;1985, members of the Toronto arts org <a href="http://interaccess.org/">InterAccess</a> used Telidon systems to produce an ambitious series of <a href="https://motherboard.vice.com/en_us/article/ezveak/the-original-net-artists">interactive BBS-based artworks</a> in the format.
				</p>
				<!--
				<p>
					Three anniversary events were held at InterAccess in spring 2018:<br/>
					<a href="http://interaccess.org/event/2018/naplps-adventure-new-media-art-history">http://interaccess.org/event/2018/naplps-adventure-new-media-art-history</a><br/>
					<a href="http://interaccess.org/event/2018/digital-archaeology-excavating-telidon">http://interaccess.org/event/2018/digital-archaeology-excavating-telidon</a><br/>
					<a href="http://interaccess.org/exhibition/telidon">http://interaccess.org/exhibition/telidon</a>
				</p>
				-->
				<p>
					Nick Fox-Gieg<br/>
					180326
				</p>
			</div>
		</div>
	</body>

</html>